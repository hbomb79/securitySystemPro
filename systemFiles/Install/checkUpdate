
-- Reads the local version file to obtain current running version
currentVersionFile = fs.open("/version", "r")
currentVersion = currentVersionFile.readLine()
currentVersionFile.close()

term.clear()
term.setCursorPos(1,1)

local function downloadFiles(url, path)
for i = 1, 3 do
  local response = http.get(url)
  if response then
   local data = response.readAll()
   if path then
        local f = io.open(path, "w")
        f:write(data)
        f:close()
   end
   return true
  end
end
return false
end


function getAvailableVersion(updateURL)
  for i = 1, 3 do
    response = http.get(updateURL)
	if response then
	    data = response.readLine()
	    if currentVersion ~= data then
		  print "Update Available, Downloading!"
		  if not fs.exists("/systemFiles/Install/updater") then
		   print "Installer Missing!"
		    downloadFiles("https://raw.github.com/hbomb79/securitySystemPro/master/updater", "/systemFiles/Install/updater")
		  end
		  print ("Latest Version: "..data)
		  print ("Running Version: "..currentVersion)
		  print "Updating Updater To Latest Firmware"
		   --[[if fs.exists "SystemFiles/Install/updater" then
		     fs.delete"systemFiles/Install/updater"
		   end
            downloadFiles("https://raw.githubusercontent.com/hbomb79/securitySystemPro/master/updater", "systemFiles/Install/updater")
			print "Updater Updated To Latest Firmware!"]]--
			print "Updater Initialise!"
			sleep(1)
			shell.run "systemFiles/Install/updater"
			return true
		 else
		   print "You Are Running The Latest Version"
	       error "Running Latest Version"
		   return true
		end
	else
	  error ("The URL: "..updateURL.." Does Not Seem To Exist [404]")
	end
  end
  error ("[208] An error occurred whilst received a response from: "..updateURL)
end

getAvailableVersion("https://raw.githubusercontent.com/hbomb79/securitySystemPro/master/version")